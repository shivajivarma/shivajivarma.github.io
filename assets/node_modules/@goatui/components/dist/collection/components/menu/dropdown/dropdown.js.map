{"version":3,"file":"dropdown.js","sourceRoot":"","sources":["../../../../src/components/menu/dropdown/dropdown.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, ComponentInterface, Element, h, Host, Listen, Method, Prop, State } from '@stencil/core';\nimport { isEventTriggerByElement, isMobile, isOutOfViewport } from '../../../utils/utils';\n\n/**\n * @name Dropdown\n * @description Enables native inputs to be used within a Form field.\n * @img /assets/img/dropdown.png\n */\n@Component({\n  tag: 'goat-dropdown',\n  styleUrl: 'dropdown.scss',\n  shadow: true,\n})\nexport class Dropdown implements ComponentInterface {\n\n  /**\n   * The button size.\n   * Possible values are: `\"sm\"`, `\"md\"`, `\"lg\"`. Defaults to `\"md\"`.\n   */\n  @Prop() size: 'sm' | 'md' | 'lg' = 'md';\n\n  @Prop({ mutable: true }) isOpen: boolean = false;\n\n  /**\n   * If true, the user cannot interact with the button. Defaults to `false`.\n   */\n  @Prop() disabled: boolean = false;\n\n  @Prop() positions: string = 'bottom-right,top-right,bottom-left,top-left';\n\n  @Prop() items: any[] = null;\n\n  @Listen('click', { target: 'window' })\n  windowClick(evt) {\n    const path = (evt.path || evt.composedPath());\n    for (const elm of path) {\n      if (elm == this.elm)\n        return;\n    }\n    this.isOpen = false;\n  }\n\n  @Method()\n  async setFocus(elm?: HTMLElement) {\n    const firstChild = elm.children[0] || this.elm.children[0];\n    // @ts-ignore\n    if (firstChild.setFocus)\n      // @ts-ignore\n      firstChild.setFocus();\n  }\n\n  @Listen('goat:menu-item-click', { target: 'window' })\n  listenMenuItemClick(evt) {\n    if (isEventTriggerByElement(evt, this.elm)) {\n      this.closeList();\n    }\n    this.isOpen = false;\n  }\n\n  @Listen('goat:click', { target: 'window' })\n  listenClick(evt) {\n    if (isEventTriggerByElement(evt, this.elm)) {\n      this.closeList();\n    }\n    this.isOpen = false;\n  }\n\n  @Listen('keydown', { target: 'window' })\n  listenKeyDown(evt: KeyboardEvent) {\n    if (isEventTriggerByElement(evt, this.elm)) {\n      if (evt.key === 'Escape') {\n        this.closeList();\n      }\n    }\n  }\n\n  @Element() elm!: HTMLElement;\n  @State() hasFocus = false;\n  @State() position: string;\n  private dropdownContentHeight: any;\n  private dropdownContentWidth: any;\n\n  private closeList() {\n    if (!this.disabled && this.isOpen) {\n      this.isOpen = false;\n      setTimeout(() => {\n        this.setFocus(this.elm);\n      }, 100);\n    }\n  };\n\n  private openList = () => {\n    if (!this.disabled && !this.isOpen) {\n      this.isOpen = true;\n      setTimeout(() => {\n        const dropdownContent = this.elm.querySelector('[slot=\"dropdown-content\"]');\n        this.dropdownContentHeight = dropdownContent.getBoundingClientRect().height;\n        this.dropdownContentWidth = dropdownContent.getBoundingClientRect().width;\n        this.fixPosition();\n      }, 100);\n    }\n  };\n\n  componentWillLoad() {\n    if (this.positions)\n      this.position = this.positions.split(',')[0];\n  }\n\n  @Listen('scroll', { target: 'window' })\n  fixPosition() {\n    if (this.isOpen && this.dropdownContentHeight && this.dropdownContentWidth) {\n\n      if (isMobile()) {\n        this.position = 'center';\n        return;\n      }\n\n      const positions = this.positions.split(',');\n      for (let i = 0; i < positions.length; i++) {\n        const dropdownButtonRect: any = this.elm.getBoundingClientRect();\n        const dropdownContentRect: any = {};\n        if (positions[i] === 'bottom-right') {\n          dropdownContentRect.top = dropdownButtonRect.top + dropdownButtonRect.height;\n          dropdownContentRect.bottom = dropdownContentRect.top + this.dropdownContentHeight;\n          dropdownContentRect.left = dropdownButtonRect.left;\n          dropdownContentRect.right = dropdownButtonRect.left + this.dropdownContentWidth;\n        } else if (positions[i] === 'top-right') {\n          dropdownContentRect.top = dropdownButtonRect.top - this.dropdownContentHeight;\n          dropdownContentRect.bottom = dropdownButtonRect.top;\n          dropdownContentRect.left = dropdownButtonRect.left;\n          dropdownContentRect.right = dropdownButtonRect.left + this.dropdownContentWidth;\n        } else if (positions[i] === 'bottom-left') {\n          dropdownContentRect.top = dropdownButtonRect.top + dropdownButtonRect.height;\n          dropdownContentRect.bottom = dropdownContentRect.top + this.dropdownContentHeight;\n          dropdownContentRect.left = dropdownButtonRect.left - this.dropdownContentWidth;\n          dropdownContentRect.right = dropdownButtonRect.left;\n        } else if (positions[i] === 'top-left') {\n          dropdownContentRect.top = dropdownButtonRect.top - this.dropdownContentHeight;\n          dropdownContentRect.bottom = dropdownButtonRect.top;\n          dropdownContentRect.left = dropdownButtonRect.left - this.dropdownContentWidth;\n          dropdownContentRect.right = dropdownButtonRect.left;\n        }\n        const isOut = isOutOfViewport(dropdownContentRect);\n        if (!isOut.any) {\n          this.position = positions[i];\n          break;\n        }\n      }\n    }\n  };\n\n  private toggleList = () => {\n    if (this.isOpen)\n      this.closeList();\n    else\n      this.openList();\n  };\n\n  private blurHandler = () => {\n    this.hasFocus = false;\n  };\n\n  private focusHandler = () => {\n    this.hasFocus = true;\n  };\n\n  private keyDownHandler = (evt) => {\n    const $menuElm = this.getMenuElement();\n    if (evt.key === 'Enter') {\n      evt.preventDefault();\n      this.toggleList();\n    } else if (evt.key === 'ArrowDown') {\n      if (this.isOpen) {\n        evt.preventDefault();\n        $menuElm?.setFocus();\n      }\n    } else if (evt.key === 'ArrowUp') {\n      if (this.isOpen) {\n        evt.preventDefault();\n        $menuElm?.setFocus(); // focus on previous item\n      }\n    }\n  };\n\n  private getMenuElement() {\n    return this.elm.querySelector('goat-menu');\n  }\n\n  renderItems() {\n    if (this.items)\n      return <goat-menu class='items'>\n        {this.items.map((item) => {\n          return <goat-menu-item value={item.value} tabindex={this.isOpen ? '0' : '-1'}>\n            {item.icon && <goat-icon name={item.icon} slot='start' size='sm' />}\n            {item.label}\n            {item.hint && <span slot='end'>{item.hint}</span>}\n          </goat-menu-item>;\n        })}\n      </goat-menu>;\n  }\n\n  render() {\n    return (<Host has-focus={this.hasFocus} is-open={this.isOpen}>\n      <div class={{\n        'dropdown': true,\n        [this.position]: true,\n        'is-open': this.isOpen,\n      }}>\n        <button class='dropdown-button'\n                onKeyDown={this.keyDownHandler}\n                tabindex='-1'\n                onBlur={this.blurHandler}\n                onFocus={this.focusHandler}\n                disabled={this.disabled}\n                onClick={() => {\n                  this.toggleList();\n                }}>\n          <div class='slot-container'>\n            <slot />\n          </div>\n        </button>\n        <div class='dropdown-content'>\n          {this.renderItems()}\n          <slot name='dropdown-content' />\n        </div>\n      </div>\n    </Host>);\n  }\n\n}\n"]}